#include <sys/types.h>
#include <sys/socket.h>
#include <arpa/inet.h>
#include <unistd.h>
#include <iostream>
#include "unp.h"

int main( int argc, char **argv)
{
    if( argc != 2)
        err_quit( "Usage: %s <IPaddress>", argv[ 0]);

    int sockfd = Socket( AF_INET, SOCK_STREAM, 0);

    struct sockaddr_in clientaddr{};
    clientaddr.sin_family = AF_INET;
    clientaddr.sin_port   = htons( DAYTIME_SAVING_PORT);

    Inet_pton( AF_INET, argv[ 1], 
                &clientaddr.sin_addr, argv[ 1]);

    Connect( sockfd, SA( &clientaddr), sizeof( clientaddr));

    ssize_t n;
    std::string recvline( MAXLINE, 0);
    while((n = read( sockfd, &recvline[ 0], recvline.size())) > 0)
    {
        recvline[ n] = 0;
        std::cout << recvline;
    }

    if( n < 0)
        err_sys( "read error");

    return 0;
}
