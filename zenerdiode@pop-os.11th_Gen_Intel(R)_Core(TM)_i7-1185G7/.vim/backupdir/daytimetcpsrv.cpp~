#include "unp.h"
#include <arpa/inet.h>
#include <sys/types.h>
#include <cstdio>
#include <ctime>
#include <iostream>

int main( int argc MAYBE_UNSED, char **argv MAYBE_UNSED)
{
    auto listenfd = Socket( AF_INET, SOCK_STREAM, 0);

    struct sockaddr_in servaddr{};
    servaddr.sin_family = AF_INET;
    servaddr.sin_addr.s_addr = htonl( INADDR_ANY);
    /* daytime server */
    servaddr.sin_port = htons( DAYTIME_SAVING_PORT); 
    Bind( listenfd, SA( &servaddr), 
          sizeof( servaddr));
    
    listen( listenfd, LISTENQ);

    for( ;;)
    {
        auto connfd = Accept( listenfd, nullptr, nullptr);
        auto ticks = time( nullptr);
        std::string_view str_time{ ctime( &ticks)};
        Write( connfd, str_time.data(), str_time.size());
        
        Close( connfd);
    }
}
